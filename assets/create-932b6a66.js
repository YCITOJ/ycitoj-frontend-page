import{d as $,m as z,u as j,r as f,N as A,e as r,o as J,c as K,f as e,w as n,j as o,g as v,v as x,x as k,A as b,U as C,K as U,V as h,b as T,E as V}from"./index-596b62d7.js";import{p as M}from"./topic-d11f504d.js";import{m as q}from"./contest-e2535aed.js";import{l as F}from"./vue-draggable-plus-7cd4cc81.js";import"./index-c70bcbaa.js";const G={class:"box Box"},le=$({__name:"create",setup(L){const D=z(),I=j();let a=f({start:"",end:"",manager:"",problem_sets:"",title:"",info:"",contest_type:"1"}),d=f(),u=f([]),p=f();const H=f(null);async function B(){const s=await M({num:d.value});let l={num:"",title:""};l.num=d.value,l.title=s.title,u.value.push(l)}async function N(){if(p.value.length<=0)return V.error("请输入分值！");const s=await M({num:d.value});let l={num:"",title:"",score:""};l.num=d.value,l.title=s.title,l.score=p.value,u.value.push(l)}function y(s){u.value.splice(s,1)}async function R(){if(u.value.length<=0)return V.error("请添加题目！");if(a.value.contest_type=="1"){a.value.problem_sets=`${u.value[0].num}`;for(let s=1;s<u.value.length;s++)a.value.problem_sets=`${a.value.problem_sets}|${u.value[s].num}`}else if(a.value.contest_type=="2"){let s=u.value.map(l=>[l.num,l.score]);a.value.problem_sets=JSON.stringify(s)}a.value.manager=I.userInfo.id.toString(),await q(a.value),V.success("比赛创建成功！"),D.go(-1)}return A(()=>{}),(s,l)=>{const c=r("el-input"),m=r("el-form-item"),w=r("el-radio"),S=r("el-radio-group"),_=r("el-button"),i=r("el-table-column"),Y=r("el-table"),g=r("el-date-picker"),E=r("mavon-editor"),O=r("el-form");return J(),K("div",G,[e(O,{model:o(a),"label-width":"80px"},{default:n(()=>[e(m,{label:"比赛名称"},{default:n(()=>[e(c,{modelValue:o(a).title,"onUpdate:modelValue":l[0]||(l[0]=t=>o(a).title=t)},null,8,["modelValue"])]),_:1}),e(m,{label:"比赛类型"},{default:n(()=>[e(S,{modelValue:o(a).contest_type,"onUpdate:modelValue":l[1]||(l[1]=t=>o(a).contest_type=t)},{default:n(()=>[e(w,{label:"1"},{default:n(()=>[v("ICPC")]),_:1}),e(w,{label:"2"},{default:n(()=>[v("OI")]),_:1})]),_:1},8,["modelValue"])]),_:1}),x(e(m,{label:"添加题目"},{default:n(()=>[e(c,{placeholder:"请输入题目编号",modelValue:o(d),"onUpdate:modelValue":l[2]||(l[2]=t=>b(d)?d.value=t:d=t),clearable:""},{append:n(()=>[e(_,{icon:o(C),onClick:B},null,8,["icon"])]),_:1},8,["modelValue"]),e(o(F),{target:"tbody",modelValue:o(u),"onUpdate:modelValue":l[3]||(l[3]=t=>b(u)?u.value=t:u=t),animation:150,style:{width:"100%"}},{default:n(()=>[e(Y,{data:o(u),style:{width:"80%"},ref_key:"tableRef",ref:H},{default:n(()=>[e(i,{prop:"num",label:"题目编号",width:"80"}),e(i,{prop:"title",label:"题目名称","show-overflow-tooltip":""}),e(i,{label:"操作",width:"180"},{default:n(t=>[e(_,{type:"danger",icon:o(U),size:"mini",onClick:h(P=>y(t.$index),["stop"])},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1},512),[[k,o(a).contest_type==="1"]]),x(e(m,{label:"添加题目"},{default:n(()=>[T("div",null,[e(c,{placeholder:"请输入题目编号",modelValue:o(d),"onUpdate:modelValue":l[4]||(l[4]=t=>b(d)?d.value=t:d=t),clearable:"",style:{width:"40%"}},null,8,["modelValue"]),e(c,{modelValue:o(p),"onUpdate:modelValue":l[5]||(l[5]=t=>b(p)?p.value=t:p=t),placeholder:"请输入分值",style:{width:"40%"}},null,8,["modelValue"]),e(_,{slot:"append",icon:o(C),onClick:N},null,8,["icon"])]),e(Y,{data:o(u),style:{width:"80%"}},{default:n(()=>[e(i,{prop:"num",label:"题目编号"}),e(i,{prop:"title",label:"题目名称"}),e(i,{prop:"score",label:"题目分值"}),e(i,{label:"操作",width:"180"},{default:n(t=>[e(_,{type:"danger",icon:o(U),size:"mini",onClick:h(P=>y(t.$index),["stop"])},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),_:1},512),[[k,o(a).contest_type==="2"]]),e(m,{label:"开始时间"},{default:n(()=>[e(g,{modelValue:o(a).start,"onUpdate:modelValue":l[6]||(l[6]=t=>o(a).start=t),style:{width:"300px"},type:"date",placeholder:"选择日期",format:"YYYY 年 MM 月 DD 日 H 点 m 分 s 秒","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(m,{label:"结束时间"},{default:n(()=>[e(g,{modelValue:o(a).end,"onUpdate:modelValue":l[7]||(l[7]=t=>o(a).end=t),style:{width:"300px"},type:"date",placeholder:"选择日期",format:"YYYY 年 MM 月 DD 日 H 点 m 分 s 秒","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(m,{label:"比赛说明"},{default:n(()=>[e(E,{modelValue:o(a).info,"onUpdate:modelValue":l[8]||(l[8]=t=>o(a).info=t)},null,8,["modelValue"])]),_:1}),e(m,null,{default:n(()=>[e(_,{type:"primary",onClick:R},{default:n(()=>[v("立即创建")]),_:1})]),_:1})]),_:1},8,["model"])])}}});export{le as default};
