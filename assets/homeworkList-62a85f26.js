import{d as D,n as O,m as T,r as m,e as u,o as l,k as i,w as o,f as n,j as r,g as f,t as H,l as q,a1 as U,D as V,E,p as $,a as P,b as z,_ as A}from"./index-596b62d7.js";import{h as M,s as F,i as G,o as J}from"./class-c50514a5.js";import"./index-c70bcbaa.js";const K=c=>($("data-v-dad6a8b6"),c=c(),P(),c),Q=K(()=>z("span",{class:"text-large font-600 mr-3"}," 作业列表 ",-1)),W=D({__name:"homeworkList",setup(c){const s=O(),w=T();let k=m(),y=m([]),a=m({prepared:!1,inqueue:!1,frontTasks:0}),h=m();async function g(){const{data:t}=await M({id:s.query.pro_id});k.value=t,y.value=k.value.prob_list}function L(t){let e=w.resolve({path:"/submit",query:{id:t.info.id,num:t.id,judgeType:t.info.judge_type,where:"class",classId:s.query.id,classProId:s.query.pro_id}});window.open(e.href,"_blank")}g();function C(){w.push({path:"/class/homework",query:{id:s.query.id}})}function R(){w.push({path:"/class/ranklist",query:{id:s.query.pro_id}})}async function x(){let{prepared:t,inqueue:e}=a.value;if(t)return await I();if(e)return;await b()}async function b(){return await F({homework_id:Number(s.query.pro_id)}),a.value.inqueue=!0,h.value=setInterval(()=>{if(console.log(a.value.inqueue===!1),a.value.inqueue===!1){clearInterval(h.value);return}v()},2e3),E.success("提交请求成功!")}async function v(){let t=await G({homework_id:Number(s.query.pro_id)});a.value=t}v();async function I(){await J({homework_id:Number(s.query.pro_id)}).then(t=>{var e=document.createElement("a");e.href=window.URL.createObjectURL(t),e.download="作业导出.pdf",e.click(),window.URL.revokeObjectURL(e.href)})}return(t,e)=>{const d=u("el-button"),N=u("el-page-header"),S=u("el-icon"),p=u("el-table-column"),j=u("el-table"),B=u("el-card");return l(),i(B,{class:"homeworkList"},{default:o(()=>[n(N,{icon:r(U),onBack:C},{content:o(()=>[Q]),extra:o(()=>[r(a).inqueue?(l(),i(d,{key:0,type:"success"},{default:o(()=>[f("排队生成中，还有"+H(r(a).frontTasks)+" 个",1)]),_:1})):(l(),i(d,{key:1,type:"success",onClick:e[0]||(e[0]=_=>b())},{default:o(()=>[f("提交生成作业请求")]),_:1})),r(a).prepared&&r(a).inqueue===!1?(l(),i(d,{key:2,type:"primary",onClick:e[1]||(e[1]=_=>x())},{default:o(()=>[f("下载作业")]),_:1})):q("",!0),n(d,{type:"primary",onClick:e[2]||(e[2]=_=>R())},{default:o(()=>[f("排行榜")]),_:1})]),_:1},8,["icon"]),n(j,{data:r(y),style:{width:"100%"},onRowClick:L},{default:o(()=>[n(p,{label:"状态",width:"60"},{default:o(_=>[_.row.ac?(l(),i(S,{key:0,size:20},{default:o(()=>[n(r(V))]),_:1})):q("",!0)]),_:1}),n(p,{prop:"id",label:"编号",width:"100"}),n(p,{prop:"name",label:"题目"}),n(p,{prop:"score",label:"分值",width:"80",align:"center"})]),_:1},8,["data"])]),_:1})}}});const ee=A(W,[["__scopeId","data-v-dad6a8b6"]]);export{ee as default};
