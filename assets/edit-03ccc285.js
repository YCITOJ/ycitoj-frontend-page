import{d as $,n as q,m as z,r as f,N as j,e as i,o as A,c as J,f as e,w as u,j as a,g as v,v as C,x as k,A as b,U,K as M,V as h,b as K,E as V}from"./index-596b62d7.js";import{p as D}from"./topic-d11f504d.js";import{b as L,u as T}from"./contest-e2535aed.js";import{l as F}from"./vue-draggable-plus-7cd4cc81.js";import"./index-c70bcbaa.js";const G={class:"box Box"},te=$({__name:"edit",setup(Q){const y=q(),H=z();let t=f({id:y.query.id,start:"",end:"",manager:"",problem_sets:"",title:"",info:"",contest_type:"1"}),s=f(),d=f([]),p=f();async function I(){const{data:n}=await L({id:y.query.id});t.value.title=n.title,d.value=n.prob_list,t.value.start=n.start_time,t.value.end=n.end_time,t.value.contest_type=n.contest_type.toString(),t.value.info=n.information}I();async function B(){const n=await D({num:s.value});let l={num:"",title:""};l.num=s.value,l.title=n.title,d.value.push(l)}async function N(){if(p.value.length<=0)return V.error("请输入分值！");const n=await D({num:s.value});let l={num:"",title:"",score:""};l.num=s.value,l.title=n.title,l.score=p.value,d.value.push(l)}function w(n){d.value.splice(n,1)}async function R(){if(d.value.length<=0)return V.error("请添加题目！");if(t.value.contest_type=="1"){t.value.problem_sets=`${d.value[0].num}`;for(let n=1;n<d.value.length;n++)t.value.problem_sets=`${t.value.problem_sets}|${d.value[n].num}`}else if(t.value.contest_type=="2"){let n=d.value.map(l=>[l.num,l.score]);t.value.problem_sets=JSON.stringify(n)}t.value.manager=window.localStorage.getItem("userid"),await T(t.value),V.success("比赛修改成功！"),H.go(-1)}return j(()=>{}),(n,l)=>{const c=i("el-input"),r=i("el-form-item"),g=i("el-radio"),S=i("el-radio-group"),_=i("el-button"),m=i("el-table-column"),Y=i("el-table"),x=i("el-date-picker"),E=i("mavon-editor"),O=i("el-form");return A(),J("div",G,[e(O,{model:a(t),"label-width":"80px"},{default:u(()=>[e(r,{label:"比赛名称"},{default:u(()=>[e(c,{modelValue:a(t).title,"onUpdate:modelValue":l[0]||(l[0]=o=>a(t).title=o)},null,8,["modelValue"])]),_:1}),e(r,{label:"比赛类型"},{default:u(()=>[e(S,{modelValue:a(t).contest_type,"onUpdate:modelValue":l[1]||(l[1]=o=>a(t).contest_type=o)},{default:u(()=>[e(g,{label:"1"},{default:u(()=>[v("ICPC")]),_:1}),e(g,{label:"2"},{default:u(()=>[v("OI")]),_:1})]),_:1},8,["modelValue"])]),_:1}),C(e(r,{label:"添加题目"},{default:u(()=>[e(c,{placeholder:"请输入题目编号",modelValue:a(s),"onUpdate:modelValue":l[2]||(l[2]=o=>b(s)?s.value=o:s=o),clearable:""},{append:u(()=>[e(_,{icon:a(U),onClick:B},null,8,["icon"])]),_:1},8,["modelValue"]),e(a(F),{target:"tbody",modelValue:a(d),"onUpdate:modelValue":l[3]||(l[3]=o=>b(d)?d.value=o:d=o),animation:150,style:{width:"100%"}},{default:u(()=>[e(Y,{data:a(d)},{default:u(()=>[e(m,{prop:"num",label:"题目编号",width:"80"}),e(m,{prop:"title",label:"题目名称","show-overflow-tooltip":""}),e(m,{label:"操作",width:"180"},{default:u(o=>[e(_,{type:"danger",icon:a(M),size:"mini",onClick:h(P=>w(o.$index),["stop"])},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1},512),[[k,a(t).contest_type==="1"]]),C(e(r,{label:"添加题目"},{default:u(()=>[K("div",null,[e(c,{placeholder:"请输入题目编号",modelValue:a(s),"onUpdate:modelValue":l[4]||(l[4]=o=>b(s)?s.value=o:s=o),clearable:"",style:{width:"40%"}},null,8,["modelValue"]),e(c,{modelValue:a(p),"onUpdate:modelValue":l[5]||(l[5]=o=>b(p)?p.value=o:p=o),placeholder:"请输入分值",style:{width:"40%"}},null,8,["modelValue"]),e(_,{slot:"append",icon:a(U),onClick:N},null,8,["icon"])]),e(Y,{data:a(d),style:{width:"80%"}},{default:u(()=>[e(m,{prop:"num",label:"题目编号"}),e(m,{prop:"title",label:"题目名称"}),e(m,{prop:"score",label:"题目分值"}),e(m,{label:"操作",width:"180"},{default:u(o=>[e(_,{type:"danger",icon:a(M),size:"mini",onClick:h(P=>w(o.$index),["stop"])},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),_:1},512),[[k,a(t).contest_type==="2"]]),e(r,{label:"开始时间"},{default:u(()=>[e(x,{modelValue:a(t).start,"onUpdate:modelValue":l[6]||(l[6]=o=>a(t).start=o),style:{width:"300px"},type:"date",placeholder:"选择日期",format:"YYYY 年 MM 月 DD 日 H 点 m 分 s 秒","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(r,{label:"结束时间"},{default:u(()=>[e(x,{modelValue:a(t).end,"onUpdate:modelValue":l[7]||(l[7]=o=>a(t).end=o),style:{width:"300px"},type:"date",placeholder:"选择日期",format:"YYYY 年 MM 月 DD 日 H 点 m 分 s 秒","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(r,{label:"比赛说明"},{default:u(()=>[e(E,{modelValue:a(t).info,"onUpdate:modelValue":l[8]||(l[8]=o=>a(t).info=o)},null,8,["modelValue"])]),_:1}),e(r,null,{default:u(()=>[e(_,{type:"primary",onClick:R},{default:u(()=>[v("立即修改")]),_:1})]),_:1})]),_:1},8,["model"])])}}});export{te as default};
