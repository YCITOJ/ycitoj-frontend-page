import{d as H,n as L,m as F,u as j,r as f,i as A,N as O,e as b,o as w,c as C,b as t,j as s,f as u,w as p,O as P,P as Q,A as M,l as Z,t as l,k as B,g as R,F as z,Q as G,E as J,p as K,a as W,_ as X}from"./index-596b62d7.js";import{b as Y,c as ee,r as te,e as se}from"./contest-e2535aed.js";import{_ as oe}from"./regList.vue_vue_type_script_setup_true_lang-305396e2.js";import"./index-c70bcbaa.js";const x=h=>(K("data-v-1f4b308a"),h=h(),W(),h),ie={class:"top"},ne={class:"Box"},ae={key:0,class:"btns"},le={class:"title"},de={class:"info"},ce={class:"left"},re={class:"list"},ue={class:"item"},_e={class:"item"},me={class:"item"},fe={class:"right"},pe={class:"time-top"},he=x(()=>t("div",{class:"time-title"},"距报名结束：",-1)),ve={class:"time"},ye={class:"day item"},ge=x(()=>t("span",{class:"icon"},"天",-1)),be={class:"hours item"},we=x(()=>t("span",{class:"icon"},":",-1)),xe={class:"minutes item"},ke=x(()=>t("span",{class:"icon"},":",-1)),qe={class:"second item"},Ie={class:"right-button"},Se={class:"md Box"},Ve=H({__name:"registration",setup(h){const d=L(),k=F(),D=j();let n=f({id:null,start_time:"",end_time:"",title:"",information:"",contest_type:null,state:null,prob_list:null}),q=f({time:null}),S=f(0),e=A({days:"0",hours:"00",minutes:"00",seconds:"00"}),I=f(!1),c=f(!1);async function N(){const{data:o}=await Y({id:d.query.id});n.value=o;const i=new Date(n.value.start_time),a=new Date(n.value.end_time),m=Math.abs(a.getTime()-i.getTime()),y=Math.floor(m/(1e3*60*60)),g=Math.floor(m%(1e3*60*60)/(1e3*60));g==0?q.value={time:`${y}小时`}:q.value={time:`${y}小时${g}分钟`},n.value.start_time=o.start_time,$()}async function V(){const o=await ee({contest_id:d.query.id});S.value=o.data}let v;function $(){const o=new Date,a=new Date(n.value.start_time)-o;if(a<=0){e.days=0,e.hours="00",e.minutes="00",e.seconds="00",k.push({name:"contestHome",query:{id:d.query.id}});return}e.days=Math.floor(a/(1e3*60*60*24)),e.hours=_(Math.floor(a%(1e3*60*60*24)/(1e3*60*60))),e.minutes=_(Math.floor(a%(1e3*60*60)/(1e3*60))),e.seconds=_(Math.floor(a%(1e3*60)/1e3)),v=setInterval(()=>{e.seconds--,e.seconds=_(e.seconds),e.seconds<0&&(e.minutes--,e.minutes=_(e.minutes),e.seconds=59),e.minutes<0&&(e.hours--,e.hours=_(e.hours),e.minutes=59),e.hours<0&&(e.days--,e.hours=23),e.days<0&&(e.days=0,e.hours="00",e.minutes="00",e.seconds="00",clearInterval(v),k.push({name:"contestHome",query:{id:d.query.id}}))},1e3)}function _(o){return o<10&&o>=0?"0"+o:o}function T(){G.confirm("确定要报名该比赛?","提示",{confirmButtonText:"确定",type:"success"}).then(async()=>{await te({id:d.query.id}),J.success("报名成功"),I.value=!0,V()})}async function U(){const o=await se({contest_id:d.query.id});I.value=o.verdict}function E(){k.push({path:"/contestHome",query:{id:d.query.id}})}return N(),V(),U(),O(()=>{clearInterval(v),v=null}),(o,i)=>{const a=b("el-tooltip"),m=b("el-button"),y=b("mavon-editor"),g=b("el-dialog");return w(),C(z,null,[t("div",ie,[t("div",ne,[s(D).isSuperAdmin()?(w(),C("div",ae,[u(a,{class:"box-item",effect:"dark",content:"题目列表",placement:"bottom"},{default:p(()=>[u(s(P),{style:{width:"2em",height:"2em","margin-right":"8px",color:"#fff"},onClick:i[0]||(i[0]=r=>E())})]),_:1}),u(a,{class:"box-item",effect:"dark",content:"报名列表",placement:"bottom"},{default:p(()=>[u(s(Q),{style:{width:"2em",height:"2em","margin-right":"8px",color:"#fff"},onClick:i[1]||(i[1]=r=>M(c)?c.value=!0:c=!0)})]),_:1})])):Z("",!0),t("div",le,l(s(n).title),1),t("div",de,[t("div",ce,[t("div",re,[t("div",ue,"比赛时间："+l(s(n).start_time)+" 至 "+l(s(n).end_time),1),t("div",_e,"比赛时长："+l(s(q).time),1),t("div",me,"报名人数："+l(s(S)),1)])]),t("div",fe,[t("div",pe,[he,t("div",ve,[t("div",ye,l(s(e).days),1),ge,t("div",be,l(s(e).hours),1),we,t("div",xe,l(s(e).minutes),1),ke,t("div",qe,l(s(e).seconds),1)])]),t("div",Ie,[s(I)?(w(),B(m,{key:1,type:"primary",disabled:""},{default:p(()=>[R("已报名")]),_:1})):(w(),B(m,{key:0,type:"primary",onClick:i[2]||(i[2]=r=>T())},{default:p(()=>[R("报名")]),_:1}))])])])])]),t("div",Se,[u(y,{modelValue:s(n).information,"onUpdate:modelValue":i[3]||(i[3]=r=>s(n).information=r),subfield:!1,defaultOpen:"preview",toolbarsFlag:!1,editable:!1,scrollStyle:!0,ishljs:!0,boxShadow:!1,previewBackground:"#eee",boxShadowStyle:"0 0 0 0"},null,8,["modelValue"])]),u(g,{title:"报名列表",modelValue:s(c),"onUpdate:modelValue":i[4]||(i[4]=r=>M(c)?c.value=r:c=r),width:"80%"},{default:p(()=>[u(oe,{contestId:s(d).query.id},null,8,["contestId"])]),_:1},8,["modelValue"])],64)}}});const De=X(Ve,[["__scopeId","data-v-1f4b308a"]]);export{De as default};
